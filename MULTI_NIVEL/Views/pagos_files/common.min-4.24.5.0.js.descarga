function loadIndexByCountry(e){expressCommon.redirect(e)}!function(){function e(){var e=window.location.search.substring(1),t=e.split("&"),o={};if(""==e)return{};for(var n=0;n<t.length;n++){var r=t[n].split("=");"countryid"!==unescape(r[0]).toLowerCase()&&"channelid"!==unescape(r[0]).toLowerCase()&&(o[unescape(r[0])]=unescape(r[1]))}return o.CountryId=viewModel.SelectedCountryId,o.ChannelId="1"===viewModel.SelectedChannelId?"CASH":"ONLINE",o}function t(){$.ajax({url:expressCommon.urls.SetProductIDExpressTokens,type:"POST",data:"{'tokenID':'"+viewModel.TokenId+"','productID':'"+viewModel.ProductID+"'}",dataType:"json",contentType:"application/json; charset=utf-8",error:function(){},success:function(){}})}function o(){$.ajax({url:expressCommon.urls.SaveVisitor,type:"POST",data:"{'tokenId':'"+viewModel.TokenId+"', 'countryId':'"+viewModel.SelectedCountryId+"' ,'productId':'"+viewModel.ProductID+"', 'expressVersion':'v4'}",dataType:"json",contentType:"application/json; charset=utf-8",error:function(){},success:function(){}})}function n(e,t,o){var n=new RegExp("([?;&])"+e+"[^&;]*[;&]?"),r=o.replace(n,"$1").replace(/&$/,"");return(r.length>2?r+"&":"?")+(t?e+"="+t:"")}function r(e){var t,o,n=decodeURIComponent(window.location.search.substring(1)).split("&");for(o=0;o<n.length;o++)if((t=n[o].split("="))[0].toLowerCase()===e.toLowerCase())return void 0===t[1]||t[1]}function i(e){var t,o=decodeURIComponent(window.location.search.substring(1)).split("&");for(t=0;t<o.length;t++)if(o[t].split("=")[0].toLowerCase()===e.toLowerCase())return!0;return!1}function a(e){var t,o=decodeURIComponent(window.location.search.substring(1)).split("&"),n="";for(t=0;t<o.length;t++)"channelid"!==o[t].split("=")[0].toLowerCase()?n+=(0==t?"":"&")+o[t]:n+=(0==t?"":"&")+"ChannelId="+e;return n}function s(e){for(var t=document.cookie.split("; "),o=t.length-1;o>=0;o--){var n=t[o].split("=");if(e==n[0])return unescape(n[1])}return"~"}function c(e,t){document.cookie=e+"="+escape(t)}function p(e,t){var o=s(e);return-1==o.indexOf("~"+t+"~")&&(o+=t+"~",c(e,o),!0)}function u(){var e=location.href.substring(location.href.lastIndexOf("/")+1);return pos=e.indexOf("."),pos>-1&&(e=e.substr(0,pos)),e}this.ExpressCommon=function(){this.urls={UrlError:siteRoot+"Checkout/Error",SaveVisitor:siteRoot+"Checkout/SaveVisitor",loadIndexByCountry:siteRoot+"Checkout/Index",SaveShopperDetail:siteRoot+"Checkout/SaveShopperDetail",GetHtmlContentError:siteRoot+"Checkout/GetHtmlContentError",ExecuteRenderAction:siteRoot+"Checkout/ExecuteRenderAction",UrlGetTransactionStatus:siteRoot+"Checkout/GetTransactionStatus",ReturnToMerchantUrl:siteRoot+"Checkout/GetUrlForReturnToMerchant",SaveExperimentVariation:siteRoot+"Checkout/SaveExperimentVariation",GetRenderProviderContent:siteRoot+"Checkout/GetRenderProviderContentV4",SendPaymentInformationSMS:siteRoot+"Checkout/SendPaymentInformationSMS",SetProductIDExpressTokens:siteRoot+"Checkout/setProductIDExpressTokens",GetUrlForRedirectToMerchant:siteRoot+"Checkout/GetUrlForReturnToMerchant",GetPaymentInformationHtml:siteRoot+"Checkout/GetPaymentInformationHtml",GetShopperConfirmationHtml:siteRoot+"Checkout/GetShopperConfirmationHtml",SendPaymentInformationEmail:siteRoot+"Checkout/SendPaymentInformationEmail",SendShopperConfirmationEmail:siteRoot+"Checkout/SendShopperConfirmationEmail",SaveReturnToMerchant:siteRoot+"Checkout/SaveReturnToMerchant",ValidateCpfDocument:siteRoot+"Checkout/ValidateCpfDocument",ValidateCpfDocumentExt:siteRoot+"Checkout/ValidateCpfDocumentExt",UpdateNotificationSubscription:siteRoot+"Checkout/UpdateNotificationSubscription",GetAchAvailableBanks:siteRoot+"Checkout/GetAchAvailableBanks",ValidateRut:siteRoot+"Checkout/ValidateRut",GetBanksForAutoComplete:siteRoot+"Checkout/GetBanksForAutoComplete"}};var l=$("body");ExpressCommon.prototype.setProductIDExpressTokens=function(){setTimeout(function(){t.call(this)},0)},ExpressCommon.prototype.saveVisitor=function(){setTimeout(function(){o.call(this)},0)},ExpressCommon.prototype.getUrlForChannelTab=function(e){return a(e)},ExpressCommon.prototype.isUrlParameterExist=function(e){return i(e)},ExpressCommon.prototype.getCustomDate=function(){var e=new Date,t=e.getDate(),o=e.getMonth()+1,n=e.getFullYear(),r=e.getMinutes(),i=e.getSeconds();return n+"_"+o+"_"+t+"_"+e.getHours()+"_"+r+"_"+i+"_"+e.getMilliseconds()},ExpressCommon.prototype.isIE=function(){var e=/MSIE (\d+)/.exec(navigator.userAgent);return e=e?e[1]:null,null==e?0:e},ExpressCommon.prototype.getBrowserName=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("safari")&&(e=t.indexOf("chrome")>-1?"Chrome":"Safari"),e},ExpressCommon.prototype.openNewWindowInSafari=function(e){var t=window.document.createElement("a");viewModelDynamicContent.showBankInPopup&&viewModelDynamicContent.showBankInPopup()?t.setAttribute("onclick","window.open('"+e+"','_blank','height=500,width=500');return false"):(t.target="_blank",t.href=e);var o=window.document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(o)},ExpressCommon.prototype.getUrlParameter=function(e){return r(e)},ExpressCommon.prototype.replaceQueryParam=function(e,t,o){return n(e,t,o)},ExpressCommon.prototype.setOnlinePaymentUrl=function(t){$("#"+t).attr("href",window.location.pathname+"?"+jQuery.param(e.call(this)))},ExpressCommon.prototype.setCashPaymentUrl=function(t){$("#"+t).attr("href",window.location.pathname+"?"+jQuery.param(e.call(this)))},ExpressCommon.prototype.callGoogleAnalytics=function(e,t,o){ga("send","event",e,t,"TokenID="+viewModel.TokenId+", MerchantCode="+viewModel.MerchantCode+o)},ExpressCommon.prototype.getSupportedChannels=function(){var e=[];return expressCommon.evaluateSupportedOnlineChannel()&&e.push(new Channel("1","Online")),expressCommon.evaluateSupportedCashChannel()&&e.push(new Channel("2","Cash")),e},ExpressCommon.prototype.evaluateSupportedOnlineChannel=function(){var e=!1;return"1"===viewModelDynamicContent.DefaultChannelId?e=!0:viewModelDynamicContent.ShowPaymentOption&&(e=!0),e},ExpressCommon.prototype.evaluateSupportedCashChannel=function(){var e=!1;return"2"===viewModelDynamicContent.DefaultChannelId?e=!0:viewModelDynamicContent.ShowPaymentOption&&(e=!0),e},ExpressCommon.prototype.redirect=function(e){var t=$("#countryForm")[0];t.action="Index"+window.location.search,t.ChangedCountryID.value=e,t.submit()},ExpressCommon.prototype.showErrorPage=function(){expressCommon.startLoading();try{if(-1===viewModel.ErrorNumber)return viewModel.setErrorNumber(),void viewModel.setErrorDescription();var e={merchantCode:viewModel.MerchantCode,countryId:viewModel.CountryDefaultId,language:viewModel.LanguageDefault,errorCode:viewModel.ErrorNumber},t=JSON.stringify(e);$.ajax({url:expressCommon.urls.GetHtmlContentError,type:"POST",data:"{'data':'"+t+"'}",dataType:"json",contentType:"application/json; charset=utf-8",error:function(){viewModel.setErrorNumber(),viewModel.setErrorDescription(),expressCommon.stopLoading()},success:function(e){""===e?(viewModel.setErrorNumber(),viewModel.setErrorDescription(),viewModelDynamicContent.ShowWaitingState&&expressWaitingState.finalize()):($("div#DynamicRenderContent.col-sm-7").html(e),$("#expressHeader").html(""),viewModelDynamicContent.ShowWaitingState&&expressWaitingState.finalize(),ko.applyBindings(viewModel,document.getElementById("ErrorMessageContent"))),expressCommon.stopLoading()}})}catch(e){console.log(e),expressCommon.stopLoading()}},ExpressCommon.prototype.getErrorMessage=function(e){var t="";switch(e){case 1003:t=viewModel.ErrorMessages.ExpiredToken;break;case 2002:t=viewModel.ErrorMessages.ExpiredTransaction;break;case 2003:case 1004:t=viewModel.ErrorMessages.PaidTransaction;break;case 2005:var o=viewModel.ErrorMessages.AvoidedTransaction;if(""!=o&&o.indexOf("{0}")>=0)if(""!=viewModel.MerchantName.Value.Text&&null!=viewModel.MerchantName.Value.Text&&void 0!=viewModel.MerchantName.Value.Text)o=(o=o.replace("{0}"," ")).replace("{1}",viewModel.MerchantName.Value.Text);else{var n=o.indexOf("{0}");o=o.substring(0,n)}t=o;break;case 2006:t=viewModel.ErrorMessages.TransactionInProcess}return t},ExpressCommon.prototype.debounce=function(e,t,o){var n;return function(){var r=this,i=arguments,a=o&&!n;clearTimeout(n),n=setTimeout(function(){n=null,o||e.apply(r,i)},t),a&&e.apply(r,i)}},ExpressCommon.prototype.pageFirstTime=function(){return p("pWrD4jBo",u.call(this))},ExpressCommon.prototype.startLoading=function(){l.addClass("loading")},ExpressCommon.prototype.stopLoading=function(){l.removeClass("loading")},ExpressCommon.prototype.executeRenderAction=function(e,t,o){return $.ajax({url:expressCommon.urls.ExecuteRenderAction,async:!1,type:"POST",data:"{'renderId':'"+e+"','renderAction':'"+t+"','parameters':'"+o+"'}",dataType:"json",contentType:"application/json; charset=utf-8"})},ExpressCommon.prototype.returnToMerchant=function(){var e=viewModel.TokenId;$.ajax({url:expressCommon.urls.ReturnToMerchantUrl,async:!1,type:"POST",data:"{'tokenID':'"+e+"'}",dataType:"json",contentType:"application/json; charset=utf-8",error:function(){},success:function(e){window.location=e}})}}();var expressCommon=new ExpressCommon;!function(){this.ExpressWaitingState=function(){},ExpressWaitingState.prototype.init=function(){viewModelDynamicContent.step=ko.observable(0),viewModelDynamicContent.ShowWaitingState&&(viewModelDynamicContent.setStep=function(e){viewModelDynamicContent.step(e)})},ExpressWaitingState.prototype.avoidCloseBrowser=function(e){$(window).on({beforeunload:function(){return e}})},ExpressWaitingState.prototype.redirectByAction=function(){this.finalize(),$.ajax({url:expressCommon.urls.GetUrlForRedirectToMerchant,async:!1,type:"POST",data:"{'TokenId':'"+viewModel.TokenId+"'}",dataType:"json",contentType:"application/json; charset=utf-8",error:function(){},success:function(e){var t=e;""===t&&(t=expressCommon.urls.UrlError),setTimeout(function(){window.location=t},1e3*viewModelDynamicContent.IntervalToRedirect)}})},ExpressWaitingState.prototype.finalize=function(){$(window).unbind("beforeunload")},ExpressWaitingState.prototype.updateNotificationSubscription=function(e,t,o,n){$.ajax({url:expressCommon.urls.UpdateNotificationSubscription,async:!0,type:"POST",data:JSON.stringify({token_id:e,connection_id:t,status:o,express_application:n}),dataType:"json",contentType:"application/json; charset=utf-8",error:function(){},success:function(){}})},ExpressWaitingState.prototype.startNotification=function(){var e=$.connection.notificationHubV4;$.connection.hub.qs="tokenId="+viewModel.TokenId,e.client.sendNotification=function(t,o){if(viewModel.TokenId==t)switch(o.Status){case"100":e.connection.stop(),expressWaitingState.updateNotificationSubscription(t,o.ConnectionID,o.Status,o.ExpressApplication),viewModelDynamicContent.setStep(3),expressWaitingState.redirectByAction();break;case"120":e.connection.stop(),expressWaitingState.updateNotificationSubscription(t,o.ConnectionID,o.Status,o.ExpressApplication),viewModelDynamicContent.setStep(4),expressWaitingState.redirectByAction();break;case"101":break;case"102":if(e.connection.stop(),expressWaitingState.updateNotificationSubscription(t,o.ConnectionID,o.Status,o.ExpressApplication),viewModelDynamicContent.setStep(2),viewModelDynamicContent.showVoucherPage&&viewModelDynamicContent.showVoucherPage())return expressWaitingState.finalize(),$.ajax({url:location.href,type:"POST",data:"Step=20",dataType:"json",contentType:"application/x-www-form-urlencoded",error:function(e){""===e.responseText?(viewModel.setErrorNumber(),viewModel.setErrorDescription(),viewModelDynamicContent.ShowWaitingState&&expressWaitingState.finalize()):($("#DynamicRenderContent").html(e.responseText),$("#div_print").contents().find("body").html(e.responseText),$("#expressHeader").html(""),viewModel.errorNumber=ko.observable(0),viewModel.errorDescription=ko.observable(""),viewModelDynamicContent.ShowWaitingState&&expressWaitingState.finalize(),viewModel.MerchantCss&&$("#DynamicRenderContent").append(viewModel.MerchantCss.replace(/\{ExpressCdn\}/g,viewModel.ExpressCdn)),ko.applyBindings(viewModel,document.getElementById("DynamicRenderContent")),$("#div_print").contents().find("body").html($("#DynamicRenderContent").html())),expressCommon.stopLoading()}});expressWaitingState.redirectByAction();break;case"104":e.connection.stop(),expressWaitingState.updateNotificationSubscription(t,o.ConnectionID,o.Status,o.ExpressApplication),viewModelDynamicContent.setStep(2),expressWaitingState.redirectByAction()}},e.client.joined=function(e,t){},e.client.rejoined=function(e,t){},e.client.leave=function(e,t){},$.connection.hub.url=viewModel.ExpressRoot.match("http[s]?://"+viewModel.ExpressDomain+"([^S]+)")[1]+"SignalRV4",$.connection.hub.start()}}();var expressWaitingState=new ExpressWaitingState;Number.prototype.format=function(e,t,o,n){var r="\\d(?=(\\d{"+(t||3)+"})+"+(e>0?"\\D":"$")+")",i=this.toFixed(Math.max(0,~~e));return(n?i.replace(".",n):i).replace(new RegExp(r,"g"),"$&"+(o||","))},$(window).load(function(){expressCommon.setProductIDExpressTokens(),expressCommon.pageFirstTime()&&expressCommon.callGoogleAnalytics("Load","Load",", ProductID="+viewModel.ProductID),$("p").filter(function(){return""===$.trim($(this).text())&&0==$(this).children().length}).empty()}),function(){var e=function(){$("body").css("transform","scale(1)"),setTimeout(function(){$("body").css("transform","")},10)},t=function(){$("body").css("transform","scale(1)"),setTimeout(function(){$("body").css("transform","")},10)};window.matchMedia&&window.matchMedia("print").addListener(function(o){o.matches?e():t()}),window.onbeforeprint=e,window.onafterprint=t}();